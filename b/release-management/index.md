---
layout: fa
title:  "بحثی پیرامون روال انتشار، به مناسبت انتشار گریپ‌فروت"
translations: "fa"
---

نسخه 0.1

### مقدمه

دو تا مثال، یکی این افرادی که توی کارخونه‌ها وای می‌ایستند و یک چک لیست دست‌شون هست و کنترل کیفیت رو بر اساس اون انجام می‌دند. یکی هم پالایشگاه‌ها، یکی تعریف می‌کرد از پالایشگاه بندر عباس که آلمانی‌هایی که اون رو ساختند، یک کتابخونه مستندات براش گذاشتند که بخش عمده‌اش هم فرآیندهای به کارگیری پالایشگاه هستند. می‌گفت برای کوچک‌ترین کار، مثلا زیاد کردن تولید یک ماده، یک فرآیند کامل توضیح دادند که اول چه شیر رو به چه مقداری زیاد می‌کنی، بعد چه ماده‌هایی باید اضافه بشه، بعد نیم ساعت فشار کدوم نقطه از سیستم رو چک می‌کنی، بعد دو ساعت ساعت چی رو چک می‌کنی و ...

زمانی که سیستم‌ها پیچیده می‌شند، اون قدر عوامل دخیل، افراد مرتبط و حالت‌های خطا زیاد می‌شند که واقعا پیگیری‌شون به صورت فردی و بدون ابزارهای شناختی مناسب ممکن نیست. تاکید من روی روال انتشار به همین خاطر هست، ضمن این که انتشار برای یک اپ واقعا آبروش و تعیین کننده‌ی حس مخاطبین به اون اپ هست. مثلا من واقعا هر بار که آپدیتی برای Evernote میاد واقعا خوشحال می‌شم و زود می‌رم نصب می‌کنم چون تا حالا توی هر آپدیت واقعا یکی از مشکلاتم رو حل کرده، ولی هر آپدیتی که برای بادصبا میاد صرفا حسرت نسخه‌های قبلی‌اش رو می‌خورم. چنین حسی قطعا به خاطر (عدم) توجه سازندگان اپ روی دو حوزه Product Management و Release Management هست.

### روال انتشار

من روال انتشار رو توافق بین تمام افراد دخیل در پروژه می‌دونم که اولا نکات و جزئیات مهم برای انتشار رو بیان می‌کنه، ثانیا حالات خاص و مشکلات احتمالی رو بررسی می‌کنه، و ثالثا که تصمیم‌هایی که ممکنه به صورت ضمنی یا قائم به افراد در زمان انتشار گرفته بشه رو صریح و شفاف و ثابت می‌کنه.

خوب مثلا روال انتشار چه چیزهایی باید داشته باشه؟ یکی این که چک لیستی از کارهای مهم قبل و حین و بعد از انتشار رو مشخص کنه. مثلا تهیه کردن Changelog خوب و قابل فهم برای کاربر واقعا مهم‌ه و در عین حال به راحتی در بین کارهای دیگه از یاد می‌ره. یا مثلا روش نسخه‌گذاری و مشخص کردن نسخه با تگ روی مخزن، که به سایر اعضای تیم هم کمک کنه که دقیقا بدونند هر کامیتی در چه وضعی هست.

دیگه این که بیاد چیزهایی که معمولا بهش فکر نمی‌شه رو بیان کنه. مثلا دیروز لاینود ایمیل زده به من که یک دیتاسنتر جدید در آلمان افتتاح کردند. آیا برای هر کاری که می‌کنند چنین ایمیلی می‌زنه؟ نه. چندین سطح دارند، مثلا برای بعضی فیچرها میان بلاگ پست می‌گذارند، برای بعضی‌ها توی صفحه اول سایت‌شون می‌زنند، برای بعضی‌ها هم به همه ایمیل می‌زنند. داشتن چنین دیدی به اعلام فیچرها واقعا نشان از حرفه‌ای بودن مدیریت روابط با مشتریان یک شرکت‌ه، که خوبه که حتی اگر فعلا به این نمی‌رسیم، حداقل به عنوان امکان برامون مطرح باشه و بدونیم که چنین کارهایی هم می‌شه کرد. یا مثلا این سوال که چه زمانی برای انتشار نسخه جدید بهتره؟ اول هفته، آخر هفته، اعیاد، اول روز، آخر روز، ...؟ خیلی از این سوال‌ها و سوال‌های خیلی جزئی‌تر رو شرکت‌هایی هستند که با روش‌هایی مثل A/B Testing حداقل با آزمایش در موردش به جواب می‌رسند، ما که دغدغه کار محتوایی و فلسفی هم داریم (که خیلی هم خوبه و در تاییدش گفتم).

دیگه این که بیاد یک سری اصول کیفیتی رو اجبار کنه روی خروجی. از داشتن روال ساده تست برای ساده‌تر شدن و مشخص‌تر شدن روش یک دور تست کلی اپ گرفته، تا اصولی مثل این که بگیم هر کامیت غیر bugfix، حداقل باید پنج روز روی master بوده باشه (و به تبع تست شده باشه) قبل از این که منتشر بشه. یا مثلا این که دوره بتای مشخص داشته باشیم برای هر نسخه که می‌خواد بره روی بازار، که در این دوره خود بچه‌های شرکت از یک کانال آزمایشی (مثلا arsh/repo) اپ رو بگیرند و در مقیاس کوچک همه تست کنند (اصطلاح درست‌تر از beta برای این کار، dog food هست! بلانسبت...). یا از همه مهم‌تر، مسئول تایید نهایی انتشار یک نسخه از اپ کیه؟

دیگه این که حالت‌های خاص و مشکلات احتمالی رو پیش‌بینی کنه. مثلا دقیق مشخص کنیم که موقع انتشار باید یک نفر از تیم اپ و یک نفر از تیم وب باشند و با بررسی analytics و logs.arsh و خود لاگ‌های api، هر مورد مشکوکی رو ثبت کنند و مورد بررسی قرار بدند. به خصوص این که باگ‌های رخ داده رو پیگیری کنند. این مورد واقعا نیاز به پیش‌بینی کاملی داره چون مشکلات ممکن حالات مختلفی داره. مثلا این که فرض کنیم یک باگ پیدا شد، در چه صورتی باید بلافاصله نسخه جدید بدیم؟ حداکثر چند نسخه در هفته می‌تونیم بدیم که کاربران هم اذیت نشند؟ در چه حالتی اصلا ارزش داره که نسخه منتشر شده رو لغو انتشار کنیم؟ اگر مشکل از یک حدی جدی‌تر باشه، آیا لازمه مستقیما از کاربرها عذرخواهی کنیم؟ به چه صورتی؟

در این رابطه، من خیلی جدی پیشنهاد دارم که بعد از هر انتشار، برای تیم بستنی گرفته بشه و نیم ساعتی تیم بشینند و فقط بستنی بخورند. به چند دلیل، اولا که بستنی خوراکی خوشمزه‌ای‌ه! دوما این که انتشار واقعا موضوع مهم و ارزشمندی از نظر اصول مهندسی نرم‌افزار (به ویژه گرایش‌های چابکش) هست، و باید این اهمیت با چیزی به سادگی یک بستنی منتقل بشه. این موضوع هم از منظر تاثیر روی reward system مغز قابل پشتیبانی‌ه، هم از دیدگاه احادیثی شبیه این حدیث از امیرالمومنین که فرمودند «هر روز جمعه مقدارى ميوه به خانواده خود نوبر دهيد تا از آمدن جمعه خوشحال شوند». سوما هم این که با احتمال خیلی زیاد بعد از انتشار کلی کار پیش میاد، و چیزی که من در چند پروژه دیدم این بوده که تیم‌ها خیلی علاقه دارند که انتشار رو در لحظات آخر روز انجام بدند و بلافاصله بعدش برن خونه.

مورد دیگه این که انتشار یک سری هماهنگی‌هایی لازم داره. مثلا تمام اعضای توسعه باید بدونند که اگر باگی توی کدشون هست اطلاع بدند. واحد سرور باید خبر داشته باشه که اگر لازمه برای لود جدید برنامه‌ریزی کنه یا در اون بازه maintenance برنامه‌ریزی نکنه. واحد بازرگانی باید خبر داشته باشه که روش تبلیغ کنه یا اگر rebrandingهای دیگه‌ای از اون نسخه لازمه، درخواست بده. این هماهنگی‌ها خوبه که مشخص باشه، خیلی ساده‌اش این که در گروه اطلاع رسانی بشه زمان دقیق انتشار و changelog اون، ترجیحا از قبل.

دیگه هم این که برای حالت‌های خاص، مثلا زمان در دسترس نبودن برخی اعضای کلیدی تیم، تکلیف رو روشن کنه. مثلا اگر مسئول فنی تیم نبود و یک باگ باید حل می‌شد، آیا صلاح هست بدون حضور اون رفع باگ و انتشار نسخه جدید صورت بگیره؟ اگر مسئول تایید انتشار نبود چی؟ این تصمیمات اگر از قبل مشخص باشه، هم تصمیمات مهم که معمولا باید در زمان‌های حساسی گرفته بشند، حساب شده‌تر و بر اساس منطق مورد توافق همه‌ی تیم خواهند بود، هم این که احتمال متوقف ماندن کار به افراد خاص رو به حداقل می‌رسونه و از طرف دیگه حالت‌های خاصی که در اون‌ها صبر بهتر از کار سریع ولی حساب‌نشده است رو روشن‌تر می‌کنه.

### صحبت آخر

اگر روال انتشاری با این جزئیات داشته باشیم، ان شاء الله هم کیفیت خروجی بالا می‌ره، هم دقیق امکان ردگیری منبع مشکلات و رفع اون‌ها در آینده رو فراهم می‌کنه (البته ردگیری مشکل نه مقصر، اون هم با هدف اصلاح نه توبیخ)، نقش‌ها و حوزه اختیارات مشخص‌تر می‌شه، تیم بیشتر ماهیت تیم گرفته و از حالت یک مجموعه تصمیم فردی دور می‌شه، مشکلات از قبل بهشون فکر می‌شه و امکان پاسخ سریع و در عین حال حساب‌شده به اون‌ها فراهم می‌شه، استرس‌ها و دلخوری‌ها کمتر می‌شه، و در نهایت هم تیم بهتری خواهیم داشت و هم محصول بهتری و هم کاربران راضی‌تری.

ممکنه گفته بشه که این حد از بروکراسی، صرفا باعث کند شدن کار می‌شه. در پاسخ اولا باید این نگرانی رو تایید کنم و تاکید کنم که این روال رو باید در سبک‌ترین حالت ممکن نگه داشت. با این حال، خیلی از چیزها رو حتی اگر یک کم بهش توجه کنیم، به نسبت این که اصلا بهش توجه نکنیم، تاثیرات قابل توجهی داره (۸۰-۲۰). به علاوه، ایجاد اولیه اجزای مهم در فرآیند توسعه، خیلی مهم‌ه که از ابتدا صورت بگیره وگرنه هیچ وقت دیگه فرصت اجراش پیش نمیاد یا حداقل خیلی سخت‌تر خواهد بود. اگر ما الآن یک روال انتشار خوب داشته باشیم، در آینده که کار خیلی جدی‌تر می‌شه، راحت‌تر می‌تونیم فرآیند مدیریت انتشار رو جا بندازیم. از همه مهم‌تر، هدف‌گذاری پروژه‌ای مثل گریپ‌فروت، واقعا بلندمدت و در مقیاس بالاست، و اگر صرفا می‌خواستیم یک اپ ساده با تعداد محدودی کاربر بدیم، اصلا این همه زحمت پیاده‌سازی و بازرگانی و همراه اول و ... نباید می‌کشیدیم.

یک آسیب دیگه، رعایت نکردن روال هست. هرچند که حتی در صورت رعایت نکردن هم وجود روال انتشار فایده‌هایی داره، ولی باید بعد از تعیین روال، کاملا نسبت به اجرای اون در تمام شرایط سخت‌گیر باشیم، اگر هم جایی می‌بینیم که این روال در کارها ایجاد وقفه می‌کنه، باید با نظر جمعی، خود روال رو اصلاح کنیم، نه این که یک طرفه کنارش بگذاریم. مثل قانون. علاوه بر اهمیت خود انتشار، یک اصل خیلی مهم‌تر در کار تیمی این‌ه که اگر به تصمیماتی که به عنوان تیم می‌گیریم تک‌تک‌مون احترام نگذاریم و عین تصمیم خودمون ندونیمش، خیلی خیلی زود تیم از هم می‌پاشه، حداقل در باطن. البته چون خود اعضای اصلی تیم بهترین نظر رو می‌تونند در مورد مقتضیات انتشار بدند، کار تدوین این روال قطعا باید بر عهده‌ی خودشون باشه (کما این که الآن برعهده‌ی آقای مشهدی و کمال‌پور به عنوان نماینده فنی و بازرگانی تیم هست) و درش از نظرات بقیه و تجربه‌های سایر پروژه‌ها استفاده کنند.

### منابع مفید در این رابطه

به عنوان نمونه‌هایی از کار سایر تیم‌ها، پست [How we ship GitHub for Windows][1] و ضمیمه A و B از کتاب How Google Tests Software با عناوین Chrome OS Test Plan و Test Tour for Chrome رو پیشنهاد می‌کنم که واقعا محشر هستند و خیلی خیلی ایده‌های مفید و نویی در رابطه با موضوع مطرح شده در این متن ارائه می‌کنند.

[1]: https://github.com/blog/1271-how-we-ship-github-for-windows
